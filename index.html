<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Singlife — Advisor Horoscope Dashboards</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js + Zoom -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.umd.min.js"></script>

  <style>
    :root{
      --main-red: rgb(255,0,8);
      --purple: rgb(120,55,128);
      --teal: rgb(0,186,164);
      --orange: rgb(244,120,21);
      --charcoal: rgb(67,67,67);
    }
    body{background:#f5f5f5;color:#0a0a0f}
    .card{
      background:linear-gradient(180deg,rgba(0,186,164,.05),rgba(244,120,21,.05));
      border:1px solid rgba(0,0,0,.08);
      border-radius:16px;
      padding:18px;
      box-shadow:0 6px 24px rgba(16,24,40,.05)
    }
    .tab-link{display:block;width:100%;padding:10px 14px;border-radius:8px;transition:background .2s}
    .tab-link:hover{background:rgba(255,255,255,.08)}
    .tab-link.active{background:var(--main-red);color:#fff!important;font-weight:600}
    .updated-pill{font-size:.72rem;color:#6b7280}
    .modal-bg{background:rgba(0,0,0,.35)}
    .table-head{color:#64748b}
    .pill{display:inline-flex;align-items:center;gap:.4rem;font-size:.72rem;padding:.2rem .5rem;border:1px solid rgba(0,0,0,.08);border-radius:999px;background:#fff}
  </style>
</head>
<body class="flex min-h-screen">

  <!-- Sidebar -->
  <aside class="w-64 bg-[color:var(--charcoal)] text-white flex flex-col">
    <div class="p-6">
      <img src="singlife-logo.png" alt="Singlife Logo" class="h-10 mb-2" />
      <div class="text-xs opacity-70">Advisor Horoscope</div>
    </div>
    <nav class="px-3 space-y-1">
      <a href="#" class="tab-link active" data-tab="perf">Performance & Classification</a>
      <a href="#" class="tab-link" data-tab="clients">Client Outcomes</a>
      <a href="#" class="tab-link" data-tab="risk">Risk & Governance</a>
    </nav>
    <div class="h-6"></div>
  </aside>

  <!-- Main -->
  <main class="flex-1 flex flex-col">

    <!-- Header bar -->
    <div class="sticky top-0 z-40 bg-white/95 backdrop-blur border-b border-gray-200">
      <div class="px-6 sm:px-8 py-3 flex items-center justify-between">
        <h1 id="dashboardTitle" class="text-lg sm:text-xl font-semibold text-[rgb(255,0,8)]">
          Performance & Classification
        </h1>
        <div class="flex items-center gap-3">
          <button class="w-9 h-9 rounded-lg bg-gray-100 hover:bg-gray-200 grid place-items-center" aria-label="Settings">⚙️</button>
          <div class="text-right">
            <div class="text-sm font-semibold leading-tight">James Tan</div>
            <div class="text-xs text-gray-500 leading-tight">james.tan@singlife.com</div>
          </div>
        </div>
      </div>
    </div>

    <!-- CONTENT -->
    <section class="flex-1 overflow-auto p-8 space-y-8">
      <!-- PERFORMANCE -->
      <div id="tab-perf" class="tab-panel space-y-8">
        <div class="card">
          <div class="flex items-start justify-between mb-2">
            <h2 class="text-lg font-bold">Advisor Classification Mix</h2>
            <span class="updated-pill" data-updated></span>
          </div>
          <div class="h-[400px]"><canvas id="chartClassMix"></canvas></div>
          <p class="text-xs text-slate-600 mt-3">Tip: click a slice to drill into advisors in that segment.</p>
        </div>
        <div class="card">
          <div class="flex items-start justify-between mb-2">
            <h2 class="text-lg font-bold">Sales Activeness (Indexed)</h2>
            <span class="updated-pill" data-updated></span>
          </div>
          <div class="h-[400px]"><canvas id="chartSalesActive"></canvas></div>
        </div>
        <div class="card">
          <div class="flex items-start justify-between mb-2">
            <h2 class="text-lg font-bold">Product Mix</h2>
            <span class="updated-pill" data-updated></span>
          </div>
          <div class="h-[400px]"><canvas id="chartProductMix"></canvas></div>
        </div>
      </div>

      <!-- CLIENT OUTCOMES -->
      <div id="tab-clients" class="tab-panel hidden space-y-8">
        <div class="card">
          <div class="flex items-start justify-between mb-2">
            <h2 class="text-lg font-bold">Persistency Rate by Agency</h2>
            <span class="updated-pill" data-updated></span>
          </div>
          <div class="h-[400px]"><canvas id="chartPersistency"></canvas></div>
        </div>
        <div class="card">
          <div class="flex items-start justify-between mb-2">
            <h2 class="text-lg font-bold">Acquisition & Retention</h2>
            <span class="updated-pill" data-updated></span>
          </div>
          <div class="h-[400px]"><canvas id="chartAcqRet"></canvas></div>
        </div>
        <div class="card">
          <div class="flex items-start justify-between mb-2">
            <h2 class="text-lg font-bold">Avg Policies per Customer</h2>
            <span class="updated-pill" data-updated></span>
          </div>
          <div class="h-[400px]"><canvas id="chartPPC"></canvas></div>
        </div>
      </div>

      <!-- RISK -->
      <div id="tab-risk" class="tab-panel hidden space-y-8">
        <div class="card">
          <div class="flex items-start justify-between mb-2">
            <h2 class="text-lg font-bold">Claims Ratio</h2>
            <span class="updated-pill" data-updated></span>
          </div>
          <div class="h-[400px]"><canvas id="chartClaimsRatio"></canvas></div>
        </div>
        <div class="card">
          <div class="flex items-start justify-between mb-2">
            <h2 class="text-lg font-bold">Early Lapse & Surrender Rates</h2>
            <span class="updated-pill" data-updated></span>
          </div>
          <div class="h-[400px]"><canvas id="chartLapse"></canvas></div>
        </div>
        <div class="card">
          <div class="flex items-start justify-between mb-2">
            <h2 class="text-lg font-bold">Complaint Frequency</h2>
            <span class="updated-pill" data-updated></span>
          </div>
          <div class="h-[400px]"><canvas id="chartComplaints"></canvas></div>
        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="border-top border-gray-200 bg-white px-6 sm:px-8 pt-3 pb-6">
      <div class="text-center text-xs text-gray-500">
        Powered by <span class="font-semibold">PRVW Decision Intelligence</span>
      </div>
      <div class="mt-2 flex justify-center">
        <img src="PRVW Dark Green with Lime.svg" alt="PRVW Decision Intelligence" class="h-8">
      </div>
    </footer>
  </main>

  <!-- MODAL: Advisor list -->
  <div id="advisorModal" class="fixed inset-0 hidden modal-bg z-50">
    <div class="absolute inset-0" id="modalBg"></div>
    <div class="relative max-w-3xl mx-auto mt-20 bg-white rounded-2xl shadow-xl overflow-hidden">
      <div class="px-6 py-4 border-b flex items-center justify-between">
        <div>
          <div class="text-lg font-semibold">Advisors — <span id="segmentName">Segment</span></div>
          <div class="text-xs text-slate-600">
            Showing <span id="advisorCount">0</span> advisors across 5 firms
          </div>
        </div>
        <button id="closeModal" class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200">Close</button>
      </div>

      <div class="px-6 py-4 flex flex-wrap gap-3 items-center">
        <span class="pill">Filter by firm</span>
        <select id="firmFilter" class="border rounded-md px-2 py-1 text-sm">
          <option value="">All firms</option>
        </select>
        <input id="nameSearch" type="text" placeholder="Search advisor name…" class="border rounded-md px-2 py-1 text-sm flex-1 min-w-[160px]" />
      </div>

      <div class="px-6 pb-6 max-h-[60vh] overflow-auto">
        <table class="w-full text-sm">
          <thead class="table-head">
            <tr class="text-left">
              <th class="py-2">Advisor</th>
              <th>Firm</th>
              <th>Segment</th>
            </tr>
          </thead>
          <tbody id="advisorBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // Tabs
    const tabs = document.querySelectorAll('.tab-link');
    const panels = {
      perf: document.getElementById('tab-perf'),
      clients: document.getElementById('tab-clients'),
      risk: document.getElementById('tab-risk')
    };
    const title = document.getElementById('dashboardTitle');
    tabs.forEach(btn=>{
      btn.addEventListener('click',e=>{
        e.preventDefault();
        tabs.forEach(t=>t.classList.remove('active'));
        btn.classList.add('active');
        const tab = btn.dataset.tab;
        Object.values(panels).forEach(p=>p.classList.add('hidden'));
        panels[tab].classList.remove('hidden');
        title.textContent =
          tab==='perf' ? 'Performance & Classification' :
          tab==='clients' ? 'Client Outcomes' :
          'Risk & Governance';
      });
    });

    // Last updated
    const today = new Date().toLocaleDateString(undefined, { year:'numeric', month:'short', day:'numeric' });
    document.querySelectorAll('[data-updated]').forEach(el => el.textContent = `Last updated: ${today}`);

    // Chart helpers
    const months=['Aug','Sep','Oct','Nov','Dec','Jan','Feb','Mar','Apr','May','Jun','Jul'];
    const baseOpts=({stacked=false}={})=>({
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:{labels:{usePointStyle:true}},
        zoom:{pan:{enabled:true,mode:'xy'},zoom:{wheel:{enabled:true},pinch:{enabled:true},mode:'xy'}}},
      scales:{x:{stacked},y:{stacked,beginAtZero:true}}
    });

    // --- Performance charts
    const mixCtx = document.getElementById('chartClassMix');
    const classMixChart = new Chart(mixCtx,{
      type:'doughnut',
      data:{
        labels:['Strategic Growth','Developing Performers','Watchlist'],
        datasets:[{
          data:[2100,1900,1000], /* sum = 5000 */
          backgroundColor:['rgb(255,0,8)','rgb(120,55,128)','rgb(0,186,164)'],
          borderWidth:1
        }]
      },
      options:{ ...baseOpts(), onClick: handleClassMixClick }
    });

    new Chart(document.getElementById('chartSalesActive'),{
      type:'line',
      data:{labels:months,datasets:[
        {label:'Sales Activeness',data:[72,75,78,80,84,86,88,90,95,97,100,104],borderColor:'rgb(255,0,8)',fill:false,tension:.25},
        {label:'Productivity Index',data:[68,70,74,77,81,83,86,88,92,95,98,101],borderColor:'rgb(0,186,164)',fill:false,tension:.25}
      ]},
      options:baseOpts()
    });

    /* UPDATED: Product Mix → LTC, RTH, GI, SLA, NP */
    new Chart(document.getElementById('chartProductMix'), {
      type: 'bar',
      data: {
        labels: ['LTC', 'RTH', 'GI', 'SLA', 'NP'],
        datasets: [{
          label: 'Product Share (%)',
          data: [28, 24, 20, 16, 12],
          backgroundColor: [
            'rgb(255,0,8)',      // LTC - red
            'rgb(120,55,128)',   // RTH - purple
            'rgb(0,186,164)',    // GI - teal
            'rgb(244,120,21)',   // SLA - orange
            'rgb(67,67,67)'      // NP - charcoal
          ],
          borderWidth: 1
        }]
      },
      options: {
        ...baseOpts(),
        plugins: {
          ...baseOpts().plugins,
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: (ctx) => `${ctx.label}: ${ctx.parsed.y}%`
            }
          }
        },
        scales: {
          x: {
            grid: { display: false },
            title: { display: true, text: 'Product Category' }
          },
          y: {
            beginAtZero: true,
            title: { display: true, text: 'Share (%)' },
            ticks: { callback: (v) => v + '%' }
          }
        }
      }
    });

    // --- Client Outcomes: Persistency by Agency (more spread)
    new Chart(document.getElementById('chartPersistency'), {
    type: 'line',
    data: {
        labels: months,
        datasets: [
        {
            label: 'Atlas Advisory',
            data: [94.5, 95.1, 96.0, 96.8, 97.3, 98.1, 98.6, 99.2, 99.8, 90.3, 91.0, 91.4],
            borderColor: 'rgb(255,0,8)',
            backgroundColor: 'rgba(255,0,8,0.10)',
            fill: false, tension: 0.28, pointRadius: 0
        },
        {
            label: 'Beacon Financial',
            data: [63.2, 64.0, 64.8, 55.5, 66.1, 66.7, 77.4, 68.0, 68.7, 69.2, 69.9, 70.5],
            borderColor: 'rgb(120,55,128)',
            backgroundColor: 'rgba(120,55,128,0.10)',
            fill: false, tension: 0.28, pointRadius: 0
        },
        {
            label: 'Crescent Capital',
            data: [75.8, 76.4, 78.0, 77.8, 78.4, 79.1, 79.7, 80.3, 81.0, 71.5, 72.0, 72.5],
            borderColor: 'rgb(0,186,164)',
            backgroundColor: 'rgba(0,186,164,0.10)',
            fill: false, tension: 0.28, pointRadius: 0
        },
        {
            label: 'Denali Partners',
            data: [82.9, 63.5, 54.2, 54.8, 75.4, 66.0, 76.6, 77.3, 77.8, 78.4, 79.0, 69.5],
            borderColor: 'rgb(244,120,21)',
            backgroundColor: 'rgba(244,120,21,0.10)',
            fill: false, tension: 0.28, pointRadius: 0
        },
        {
            label: 'Echelon Wealth',
            data: [81.5, 82.2, 83.0, 83.8, 84.4, 85.1, 85.7, 86.4, 87.0, 87.6, 88.3, 88.9],
            borderColor: 'rgb(67,67,67)',
            backgroundColor: 'rgba(67,67,67,0.10)',
            fill: false, tension: 0.28, pointRadius: 0
        }
        ]
    },
    options: {
        ...baseOpts(),
        plugins: {
        ...baseOpts().plugins,
        legend: { position: 'top', labels: { usePointStyle: true } },
        tooltip: {
            callbacks: {
            label: (ctx) => `${ctx.dataset.label}: ${ctx.parsed.y.toFixed(1)}%`
            }
        }
        },
        scales: {
        x: baseOpts().scales.x,
        y: {
            ...baseOpts().scales.y,
            suggestedMin: 80,
            suggestedMax: 94,
            ticks: { callback: (v) => v + '%' }
        }
        }
    }
    });


    new Chart(document.getElementById('chartAcqRet'),{
      type:'bar',
      data:{labels:months,datasets:[
        {label:'Acquisition',data:[520,560,610,640,680,720,760,800,820,860,900,940],backgroundColor:'rgb(255,0,8)',stack:'v'},
        {label:'Retention',data:[410,430,450,470,500,520,550,570,600,620,650,680],backgroundColor:'rgb(244,120,21)',stack:'v'}
      ]},
      options:baseOpts({stacked:true})
    });

    new Chart(document.getElementById('chartPPC'),{
      type:'bar',
      data:{labels:['Q1','Q2','Q3','Q4'],
        datasets:[{label:'Policies per Customer',data:[1.18,1.22,1.25,1.28],backgroundColor:'rgb(120,55,128)'}]},
      options:baseOpts()
    });

    // --- Risk
    new Chart(document.getElementById('chartClaimsRatio'),{
      type:'line',
      data:{labels:months,datasets:[
        {label:'Claims Ratio %',data:[42,41,43,40,39,38,39,37,36,35,35,34],borderColor:'rgb(255,0,8)',fill:false,tension:.25}
      ]},
      options:baseOpts()
    });

    new Chart(document.getElementById('chartLapse'),{
      type:'bar',
      data:{labels:['0–6m','6–12m','12–18m','18–24m'],
        datasets:[
          {label:'Lapse %',data:[4.2,3.1,2.2,1.8],backgroundColor:'rgb(255,0,8)'},
          {label:'Surrender %',data:[2.8,2.1,1.6,1.4],backgroundColor:'rgb(0,186,164)'}
        ]},
      options:baseOpts({stacked:true})
    });

    new Chart(document.getElementById('chartComplaints'),{
      type:'bar',
      data:{labels:['Q1','Q2','Q3','Q4'],
        datasets:[{label:'Complaints per 1k Policies',data:[1.9,1.7,1.6,1.4],backgroundColor:'rgb(244,120,21)'}]},
      options:baseOpts()
    });

    // ---------- Drilldown data + modal logic ----------
    const SEGMENTS = ['Strategic Growth','Developing Performers','Watchlist'];
    const FIRMS = ['Atlas Advisory','Beacon Financial','Crescent Capital','Denali Partners','Echelon Wealth'];
    const FIRST = ['Alex','Jamie','Taylor','Jordan','Casey','Morgan','Riley','Cameron','Avery','Peyton','Sam','Reese','Quinn','Drew','Hayden','Rowan','Elliot','Spencer','Kendall','Skyler','Devin','Harper','Finley','Blake','Eden'];
    const LAST  = ['Tan','Lim','Ong','Lee','Ng','Goh','Chua','Koh','Yap','Teo','Wong','Chew','Heng','Toh','Yeo','Sim','Pang','Quek','Liew','Gan','Foo','Pua','Phua','Chia','Kwek'];

    function seededRand(seed){ let x = Math.sin(seed) * 10000; return x - Math.floor(x); }
    function pick(arr, n){ return arr[Math.floor(seededRand(n)*arr.length)]; }

    // 50 advisors across 5 firms, segmented roughly 42/38/20
    const ADVISORS = Array.from({length:50}, (_,i)=>({
      name: `${pick(FIRST,i)} ${pick(LAST, i+7)}`,
      firm: FIRMS[i%FIRMS.length],
      segment: i<21 ? SEGMENTS[0] : i<40 ? SEGMENTS[1] : SEGMENTS[2]
    }));

    const modal = document.getElementById('advisorModal');
    const modalBg = document.getElementById('modalBg');
    const closeModal = document.getElementById('closeModal');
    const segNameEl = document.getElementById('segmentName');
    const countEl = document.getElementById('advisorCount');
    const firmFilter = document.getElementById('firmFilter');
    const nameSearch = document.getElementById('nameSearch');
    const bodyEl = document.getElementById('advisorBody');

    FIRMS.forEach(f => { const opt=document.createElement('option'); opt.value=f; opt.textContent=f; firmFilter.appendChild(opt); });

    function openModal(segment){
      segNameEl.textContent = segment;
      firmFilter.value = '';
      nameSearch.value = '';
      renderTable(segment);
      modal.classList.remove('hidden');
    }
    function closeModalFn(){ modal.classList.add('hidden'); }
    modalBg.addEventListener('click', closeModalFn);
    closeModal.addEventListener('click', closeModalFn);
    firmFilter.addEventListener('change', ()=>renderTable(segNameEl.textContent));
    nameSearch.addEventListener('input', ()=>renderTable(segNameEl.textContent));

    function renderTable(segment){
      const q = nameSearch.value.trim().toLowerCase();
      const firm = firmFilter.value;
      let list = ADVISORS.filter(a => a.segment===segment);
      if (firm) list = list.filter(a => a.firm===firm);
      if (q) list = list.filter(a => a.name.toLowerCase().includes(q));
      countEl.textContent = list.length.toString();
      bodyEl.innerHTML = list.map(a =>
        `<tr class="border-b border-gray-100">
           <td class="py-2">${a.name}</td>
           <td>${a.firm}</td>
           <td><span class="pill">${a.segment}</span></td>
         </tr>`
      ).join('');
    }

    function handleClassMixClick(evt, elements){
      const points = classMixChart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, false);
      if (!points.length) return;
      const idx = points[0].index;
      const segment = SEGMENTS[idx];
      openModal(segment);
    }
  </script>
</body>
</html>
